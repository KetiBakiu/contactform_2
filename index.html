<script>
  document.getElementById("contact-form").addEventListener("submit", async function(e) {
    e.preventDefault();
    const form = e.target;

    const captchaResponse = grecaptcha.getResponse();
    if (!captchaResponse) {
      alert("Please complete the CAPTCHA.");
      return;
    }

    const toBase64 = file => new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result.split(',')[1]);
      reader.onerror = error => reject(error);
    });

    const cvFile = document.getElementById("cv").files[0];
    const motivationFile = document.getElementById("motivation").files[0];

    if (!cvFile || !motivationFile) {
      alert("Please upload both files.");
      return;
    }

    const cvBase64 = await toBase64(cvFile);
    const motivationBase64 = await toBase64(motivationFile);

    const payload = new URLSearchParams({
      firstName: form.firstName.value,
      lastName: form.lastName.value,
      email: form.email.value,
      phone: form.phone.value,
      message: form.message.value,
      "g-recaptcha-response": captchaResponse,
      cvBase64,
      motivationBase64
    });

    fetch("https://script.google.com/macros/s/AKfycbyL4AJ2gsAHHomrHHAorjLSD-TBRF9ZAzN3u74527bh9GIrFroD943cNC5vbXTF3hSb/exec", {
      method: "POST",
      body: payload
    })
    .then(res => res.text())
    .then(text => {
      if (text.includes("CAPTCHA failed")) {
        alert("CAPTCHA verification failed. Please try again.");
      } else if (text.includes("Form submitted successfully")) {
        alert("Thank you! Your form has been submitted.");
        form.reset();
        grecaptcha.reset();
      } else {
        alert("Unexpected response: " + text);
      }
    })
    .catch(err => alert("Error: " + err.message));
  });
</script>
